-- -- -- -- ROLLUP -- -- -- -- 
-- Liczba skasowanych biletów ulgowych w poszczególne dni, w poszczególnych liniach
SELECT CZAS.DATA_PRZEJAZDU AS "DATA", PRZEJAZD.LICZBA_BIL_ULGOWYCH AS "LICZBA SKASOWANYCH BIL. ULG.", PRZEJAZD.ID_LINII AS "LINIA"
FROM PRZEJAZD 
JOIN CZAS ON PRZEJAZD.ID_CZASU=CZAS.ID_CZASU 
GROUP BY ROLLUP(CZAS.DATA_PRZEJAZDU, PRZEJAZD.LICZBA_BIL_ULGOWYCH, PRZEJAZD.ID_LINII)
-- Liczba kilometrów w poszczególnych przejazdach
SELECT PRZEJAZD.ID_PRZEJAZDU, PRZEJAZD.LICZBA_KILOMETROW AS "LICZBA KM"
FROM PRZEJAZD
GROUP BY ROLLUP(PRZEJAZD.ID_PRZEJAZDU, PRZEJAZD.LICZBA_KILOMETROW)

-- -- -- -- CUBE -- -- -- -- 
-- Pensje pracowników zarz¹du komunikacji miejskiej
SELECT DISTINCT PRACOWNIK.STANOWISKO, PRACOWNIK.PENSJA
FROM PRACOWNIK
GROUP BY CUBE(PRACOWNIK.PENSJA, PRACOWNIK.STANOWISKO)
-- Liczba przystanków przez któr¹ przeje¿d¿a dana linia
SELECT LINIA.ID_LINII, ROZKLAD.LICZBA_PRZYSTANKOW
FROM LINIA
JOIN ROZKLAD ON LINIA.ID_ROZKLADU=ROZKLAD.ID_ROZKLADU
GROUP BY CUBE(LINIA.ID_LINII, ROZKLAD.LICZBA_PRZYSTANKOW)

-- -- -- -- PARTITION BY -- -- -- -- 
-- Procent linii które kursuj¹ w okreœlonej dacie
SELECT DISTINCT PRZEJAZD.ID_LINII, PRZEJAZD.ID_CZASU,
ROUND((100*COUNT(*) OVER (PARTITION BY PRZEJAZD.ID_LINII,PRZEJAZD.ID_CZASU)/COUNT(*)
OVER (PARTITION BY PRZEJAZD.ID_LINII)),2) AS "PROCENT"
FROM PRZEJAZD ORDER BY PRZEJAZD.ID_LINII, PRZEJAZD.ID_CZASU
-- Procent pojazdów kursuj¹cych okreœlon¹ lini¹
SELECT DISTINCT PRZEJAZD.ID_POJAZDU, PRZEJAZD.ID_LINII,
ROUND((100*COUNT(*) OVER (PARTITION BY PRZEJAZD.ID_POJAZDU,PRZEJAZD.ID_LINII)/COUNT(*)
OVER (PARTITION BY PRZEJAZD.ID_POJAZDU)),2) AS "PROCENT"
FROM PRZEJAZD ORDER BY PRZEJAZD.ID_POJAZDU, PRZEJAZD.ID_LINII

-- -- -- -- GROUPING SETS -- -- -- -- 
-- GRUPOWANIE calkowity zysk dla danego przejazdu
SELECT NVL(TO_CHAR(PRZEJAZD.ID_PRZEJAZDU),'DLA WSZYSTKICH') AS "ID PRZEJAZDU", PRZEJAZD.CALKOWITY_ZYSK AS "CALKOWITY ZYSK"
FROM PRZEJAZD GROUP BY grouping SETS(
	(PRZEJAZD.ID_PRZEJAZDU) ,
	(PRZEJAZD.ID_PRZEJAZDU, PRZEJAZD.CALKOWITY_ZYSK )
    )
-- Liczba kilometrów które pokonuj¹ okreœlone pojazdy na okreœlonych liniach, na podliczonej trasie
SELECT NVL(TO_CHAR(PRZEJAZD.ID_POJAZDU),'DLA WSZYSTKICH') AS "ID POJAZDU", PRZEJAZD.ID_LINII AS "ID LINII", PRZEJAZD.LICZBA_KILOMETROW AS "KILOMETRY"
FROM PRZEJAZD GROUP BY grouping SETS(
	(PRZEJAZD.ID_POJAZDU) ,
	(PRZEJAZD.ID_POJAZDU, PRZEJAZD.ID_LINII, PRZEJAZD.LICZBA_KILOMETROW )
    )

-- -- -- -- OKNA -- -- -- --
-- Œrednie czasy trwania przejazdów w latach 2017-2018
SELECT DISTINCT CZAS.DATA_PRZEJAZDU, PRZEJAZD.ID_PRZEJAZDU, 
ROUND(AVG(PRZEJAZD.CZAS_TRWANIA) OVER (PARTITION BY PRZEJAZD.ID_CZASU
ORDER BY TO_DATE(TO_CHAR(ROK.NUMER), 'YYYY') RANGE BETWEEN INTERVAL '2' YEAR PRECEDING AND CURRENT ROW),2) AS "SREDNI CZAS TRWANIA"
FROM PRZEJAZD, CZAS, ROK WHERE CZAS.ID_CZASU = PRZEJAZD.ID_CZASU AND ROK.ID_ROKU = CZAS.ID_ROKU AND ROK.NUMER BETWEEN 2017 AND 2018
ORDER BY CZAS.DATA_PRZEJAZDU
-- Œrednie liczba kilometrów dla poszczególnych kursów w latach 2015-2017
SELECT DISTINCT CZAS.DATA_PRZEJAZDU, PRZEJAZD.ID_PRZEJAZDU, 
ROUND(AVG(PRZEJAZD.LICZBA_KILOMETROW) OVER (PARTITION BY PRZEJAZD.ID_CZASU
ORDER BY TO_DATE(TO_CHAR(ROK.NUMER), 'YYYY') RANGE BETWEEN INTERVAL '2' YEAR PRECEDING AND CURRENT ROW),2) AS "SREDNIA LICZBA KILOMETROW"
FROM PRZEJAZD, CZAS, ROK WHERE CZAS.ID_CZASU = PRZEJAZD.ID_CZASU AND ROK.ID_ROKU = CZAS.ID_ROKU AND ROK.NUMER BETWEEN 2015 AND 2017
ORDER BY CZAS.DATA_PRZEJAZDU


